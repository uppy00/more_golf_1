<header class="bg-green-500 p-4">
  <div class="container mx-auto flex justify-between items-center">
    <!-- ロゴ -->
    <div class="text-white text-2xl font-bold">
      <%= link_to root_path, class: "flex items-center hover:text-gray-200" do %>
        <%= image_tag "golf_flag.webp", alt: "More Golf ロゴ", class: "w-8 h-8 mr-4 hidden sm:block" %>
        <span>More Golf</span>
      <% end %>
    </div>

    <!-- 右側（モバイル用：通知 + ハンバーガー） -->
    <div class="md:hidden flex items-center gap-4 text-white">
      <!-- 通知（モバイル用） -->
      <%= link_to notifications_path, class: "relative flex items-center hover:text-black" do %>
        <span class="relative inline-block" style="line-height: 1;">
          <i class="fa-solid fa-bell" style="font-size: 2em;"></i>

          <% if unchecked_notifications? %>
            <span class="absolute -top-1 -right-0.5 w-5 h-5 rounded-full bg-orange-500 animate-bounce"></span>
          <% end %>
        </span>
      <% end %>

      <!-- ハンバーガーボタン（スマホ用） -->
      <button id="menu-button" type="button" class="z-20 hover:text-black">
        <i id="bars" class="fa-solid fa-bars fa-2x"></i>
        <i id="xmark" class="fa-solid fa-xmark fa-2x !hidden"></i>
      </button>
    </div>


    <!-- PCナビゲーション（md以上） -->
    <div class="hidden md:flex space-x-6 text-white items-center">
      <p class="flex items-center text-white">
        ログイン中: <%= current_user.decorate.full_name %>
      </p>

      <!-- ホーム -->
      <%= link_to root_path, class: 'flex flex-col items-center hover:text-black' do %>
        <i class="fa-solid fa-house text-lg sm:text-xl md:text-2xl"></i>
        <span class="mt-1 text-xs sm:text-sm md:text-base">ホーム</span>
      <% end %>

      <!-- 新規投稿 -->
      <%= link_to new_post_path, class: 'flex flex-col items-center hover:text-black' do %>
        <i class="fa-solid fa-pen-to-square text-2xl"></i>
        <span class="mt-1 text-xs sm:text-sm md:text-base">新規投稿</span>
      <% end %>

      <!-- 投稿一覧 -->
      <%= link_to posts_path, class: 'flex flex-col items-center hover:text-black' do %>
        <i class="fa-solid fa-list text-lg sm:text-xl md:text-2xl"></i>
        <span class="mt-1 text-xs sm:text-sm md:text-base">投稿一覧</span>
      <% end %>

      <!-- いいねした記事 -->
      <%= link_to likes_posts_path, class: 'flex flex-col items-center hover:text-black' do %>
        <i class="fa-solid fa-heart text-lg sm:text-xl md:text-2xl"></i>
        <span class="mt-1 text-xs sm:text-sm md:text-base">いいねした投稿</span>
      <% end %>

      <!-- 通知された記事 -->
      <%= link_to notifications_path, class: "flex flex-col items-center hover:text-black" do %>
        <span class="relative inline-block" style="line-height: 1;">
          <i class="fa-solid fa-bell" style="font-size: 1.5em;"></i>

          <% if unchecked_notifications? %>
            <span class="absolute -top-1 -right-0.5 w-4 h-4 rounded-full bg-orange-500 animate-bounce"></span>
          <% end %>
        </span>

        <span class="mt-1 text-xs sm:text-sm md:text-base">通知</span>
      <% end %>

      <!-- マイページ -->
      <%= link_to user_path(current_user), class: "flex flex-col items-center hover:text-black" do %>
        <i class="fas fa-user text-lg sm:text-xl md:text-2xl"></i>
        <span class="mt-1 text-xs sm:text-sm md:text-base">マイページ</span>
      <% end %>

      <!-- ログアウト -->
      <%= button_to logout_path,
          method: :delete,
          form: { data: { turbo: false } },
          class: "flex flex-col items-center hover:text-black bg-transparent" do %>
        <i class="fas fa-sign-out-alt text-lg sm:text-xl md:text-2xl"></i>
        <span class="mt-1 text-xs sm:text-sm md:text-base">ログアウト</span>
      <% end %>
    </div>
  </div>

  <!-- モバイルメニュー -->
  <ul id="mobile-menu"
      class="fixed top-0 left-0 z-10 w-full  bg-green-600 text-center text-lg font-bold text-white translate-x-full transition-transform duration-300 ease-linear flex flex-col justify-center space-y-6">
    <li>
      <%= link_to root_path, class: "block pt hover:text-black" do %>
      <i class="fa-solid fa-house text-2xl pt-2"></i>
        ホーム
      <% end %>
    </li>
    <li>
      <%= link_to new_post_path, class: "block hover:text-black" do %>
      <i class="fa-solid fa-pen-to-square text-2xl"></i>
        新規投稿
      <% end %>
    </li>
    <li>
      <%= link_to posts_path, class: "block hover:text-black" do %>
      <i class="fa-solid fa-list text-2xl"></i>
        投稿一覧
      <% end %>
    </li>
    <li>
      <%= link_to likes_posts_path, class: "block hover:text-black" do %>
      <i class="fa-solid fa-heart text-2xl"></i>
        いいねした投稿
      <% end %>
    </li>
    <li>
      <%= link_to user_path(current_user), class: "block hover:text-black" do %>
      <i class="fas fa-user text-2xl"></i>
        マイページ
      <% end %>
    </li>
    <li>
      <%= button_to logout_path,
          method: :delete,
          form: { data: { turbo: false } },
          class: "w-full text-center pb-1 hover:text-black bg-transparent" do %>
          <i class="fas fa-sign-out-alt text-lg sm:text-xl md:text-2xl"></i>
        ログアウト
      <% end %>
    </li>
  </ul>
</header>

<!-- ハンバーガーメニューの開閉スクリプト -->
<script>
  function initMenu() {
    const menuButton = document.getElementById('menu-button');
    const bars = document.getElementById('bars');
    const xmark = document.getElementById('xmark');
    const mobileMenu = document.getElementById('mobile-menu');

    // 要素が存在しないページでは処理しない
    if (!menuButton || !bars || !xmark || !mobileMenu) return;

    // 二重登録を防止（重要！）
    menuButton.removeEventListener('click', handleMenuToggle);
    menuButton.addEventListener('click', handleMenuToggle);
  }

  function handleMenuToggle() {
    const bars = document.getElementById('bars');
    const xmark = document.getElementById('xmark');
    const mobileMenu = document.getElementById('mobile-menu');

    bars.classList.toggle('!hidden');
    xmark.classList.toggle('!hidden');
    mobileMenu.classList.toggle('translate-x-full');
    document.body.classList.toggle('overflow-hidden'); // 背景スクロール固定
  }

  // Turbo対応: ページ遷移のたびに初期化
  document.addEventListener('turbo:load', initMenu);

  // Fallback: Turboが無効な環境用
  document.addEventListener('DOMContentLoaded', initMenu);
</script>

